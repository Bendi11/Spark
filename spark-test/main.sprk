imp mod:puts
imp mod:structure
type str = *u8
type strbuf = *str

type cb = {
    fun(*u8) -> i32 fn,
}

type str_or_num = i32 | str

fun ext printf(*u8 fmt, *u8 b)

fun test() -> i32 {
    puts("Hi!")
    return 101
}

fun ext malloc(u64) -> *u8
fun ext free(*u8)
fun ext memcpy(*u8,*u8,u64)

fun ext main(i32 argc, **u8 argv) -> i32 {
    let mem = malloc(1000u64)
    memcpy(mem,$*u8 test,5u64)
    let *(mem + 5) = 0u8
    puts(mem)
    free(mem)
    let callback = #cb {
        fn = $(fun(*u8) -> i32) test,
    }
    let testing = test
    let res = ((callback.fn)($*u8 0))
    mod:puts("Hello, World!")
    printf("Callback returned %d\n", $*u8 res)
    printf("Here: %p\n", $*u8 printf)
    return 2 + 4 * 3
}
